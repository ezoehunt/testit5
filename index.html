<!doctype html>
<!--[if IE 8] <html class="no-js lt-ie9"> ![endif]-->
<!--[if gt IE 8] <!--> <html class="ie" lang="en"> <!-- ![endif]-->
<head>
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta charset="utf-8">
  <meta content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">

  <title>Welcome to March with Love</title>
  <meta name="description" content="&#35;ResistTrump Protests is a volunteer effort working to identify and promote upcoming events where people plan to speak out about the Trump administration.">
  <meta name="author" content="&#35;ResistTrump Protests">
  <meta name="keywords" content="U.S. government, resistance">
  <link rel="icon" href="assets/images/favicon.ico">

  <!-- Font + Style -->
  <link href="https://fonts.googleapis.com/css?family=Raleway:300,400,600,700,900" rel="stylesheet">
  <link href="assets/css/application.css" rel="stylesheet" />

  <!-- Scripts -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <!--script>window.jQuery || document.write('<script src="assets/js/fallback_jquery.min.js"><\/script>')</script-->

  <!-- from https://github.com/tristen/tablesort -->
  <script src='assets/js/vendor/tablesort.js'></script>
  <script src='assets/js/vendor/tablesort_number.js'></script>
  <script src='assets/js/vendor/tablesort_date.js'></script>
  <script src="assets/js/vendor/mustache.js"></script>

</head>

<body role="document" class="index">

<div id="container">

  <header>
    <div class="header-image">
      <img class="img-fluid" src="assets/images/header_image.png">
    </div>

    <div class="header-copy">
      <h1>#ResistTrump</h1>
    </div>

    <!--div class="header-submit hidden-sm-down">
      <a target="_blank" href="https://docs.google.com/forms/d/e/1FAIpQLSdRw49Vj-oP41XB2qwTwLWipwGDfxlNx7uCtZ0I064IJw5nxA/viewform"><button class="btn btn-primary hidden-sm-down">Submit an Event</button></a>
    </div-->

  </header>

  <nav class="navbar navbar-toggleable navbar-inverse bg-primary">
    <div class="navbar-toggler navbar-toggler-right" type="text" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">MENU</div>

    <div class="navbar-brand">&nbsp;</div>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item active">
          <a href="/" class="nav-link">Future Events<span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item ">
          <a href="/past" class="nav-link">Past Events</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" target="_blank" href="https://docs.google.com/forms/d/e/1FAIpQLSdRw49Vj-oP41XB2qwTwLWipwGDfxlNx7uCtZ0I064IJw5nxA/viewform">Submit an Event</a>
        </li>
        <li class="nav-item ">
          <a href="/about" class="nav-link">About Us</a>
        </li>
      </ul>
    </div>
  </nav>

  index.html<br/>
  /</br>
  #<Middleman::Sitemap::Resource path=index.html>

  <!-- DISPLAY HERE -->
<div id="container">
  <header>
    <div class="header-image">
      <!--p style="color:#fff;padding-top:40px;text-align:center;">#ResistTrump</p-->
    </div>

    <!--div class="header-bar">
      <ul class="nav header-bar-ul">

      <li><a class="nav-link active" href="/" title="">Home</a><li>

      <li><a target="_blank" href="https://docs.google.com/forms/d/e/1FAIpQLSc8XUpTHt8j_2N0BB0JjECD-l608iuzcH3_yc0FHZw0XH8mgA/viewform">Submit an Event</a></li>

      <li><a class="nav-link" href="news" title="">News</a><li>

      <li><a class="nav-link" href="about" title="">About</a><li>

      <li><a class="nav-link" href="mailto:townhallproject2018@gmail.com" title=""><i class="fa fa-envelope"></i> &nbsp;Contact</a><li>

      </ul>
    </div-->

  </header>

  <div class="wrapper">

    <h1>#ResistTrump Marches</h1>

    <div>
      <input id="table-input" class="light-table-filter" data-table="events-table" type="text" placeholder="Search for a State or City..."></input>

      <span id="table-reset" class="btn btn-primary reset-table-filter" data-table="events-table" style="display:none;">Reset</span>

      <br/><br/>
    </div>

    <div id="row_count" style="float:left;border:1px solid red;"></div>

    <div id="update_date" style="float:right;border:1px solid blue;"></div>

    <div id="events" style="border:1px solid green;clear:both;">

      <table class="table events-table order-table" id="events-table">
        <thead id="rows-header">
          <tr>
            <th class="" data-sort-default>Date</th>
            <th class="">State</th>
            <th class="">City</th>
            <th class="" data-sort-method="none">Time + Location</th>
            <th class="" data-sort-method="none">Event Details</th>
          </tr>
        </thead>
        <tbody id="rows-body">
          <tr><td>Loading Events...</td></tr>
        </tbody>
      </table>
    </div>
</div>

<!-- INCLUDE INIT HERE  -->
<script type="text/javascript">

  var publicSpreadsheetURL = 'https://docs.google.com/spreadsheets/d/1DzWdOnK86lLRi4nPFYRSL3IxI2CZN5FArk9RqBuaPmE/pubhtml';

  var sheetNames = {
    "0": "Events"
  }

  document.addEventListener('DOMContentLoaded', function () {
    Tabletop.init( {
      key: publicSpreadsheetURL,
      callback: getSheetData,
      wanted: [
        sheetNames[0]
      ],
      debug: true } )
  })

</script>


<!-- MOVE TO EXTERNAL JS FILES -->
<script type="text/javascript">

  //Epoch To Date
  function EpochToDate(epoch) {
    if (epoch < 10000000000)
        epoch *= 1000; // convert to milliseconds (Epoch is usually expressed in seconds, but Javascript uses Milliseconds)
    var epoch = epoch + (new Date().getTimezoneOffset() * -1); //for timeZone
    return new Date(epoch);
  }


  // Prepare the imported sheet data
  function getSheetData(data, tabletop) {
    var rows = tabletop.sheets(sheetNames[0]).all();
    var rowCount = 0;

    // Send last updated to its template
    var date = rows[0]["LAST UPDATED"];
    displayUpdateDate(date);

    // Slice off rows 2+3 that are used for meta sheet info
    var rowsSliced = rows.slice(2);

    // Remove loading message in table body
    $("#rows-body").empty();

    // Do all date stuff as a function
    // Repeat twice for each start date
    $.each(rowsSliced, function( key, row ) {
      // Today Date
      var nowDate = new Date();
      nowDate = EpochToDate(nowDate);
      var d = nowDate.getDate();
      var m = nowDate.getMonth() + 1;
      var yy = nowDate.getFullYear();
      if (d < 10) {
          d = '0' + d
      }
      if (m < 10) {
          m = '0' + m
      }
      nowDate = m + '/' + d + '/' + yy;

      // Row Date
      var startDate = row["DATE"];
      var rowDate = new Date(startDate);
      var dd = rowDate.getDate();
      var mm = rowDate.getMonth() + 1;
      var yyyy = rowDate.getFullYear();
      if (dd < 10) {
          dd = '0' + dd
      }
      if (mm < 10) {
          mm = '0' + mm
      }
      rowDate = mm + '/' + dd + '/' + yyyy;

      if (rowDate >= nowDate) {
        var template = $('#rows_template').html();
        var html = Mustache.render(template, row);
        $("#rows-body").append(html);
        ++rowCount;
      }
    });

    // For rows >= today, send count to its template
    displayRowCount(rowCount);

    // Enable sorting on relevant columns
    new Tablesort(document.getElementById("events-table"), {
      // Default sort = asc - change to below if needed
      // descending: true
    });
  }

  // Display row count + last updated outside the rows loop
  function displayRowCount(count) {
    var template = $('#row_count_template').html();
    var rendered = Mustache.render(template, {count: count});
    $('#row_count').html(rendered);
  }

  function displayUpdateDate(date) {
    var template = $('#update_date_template').html();
    var rendered = Mustache.render(template, {date: date});
    $('#update_date').html(rendered);
  }

</script>


<!-- LEAVE TEMPLATES HERE -->
<script id="rows_template" type="text/template">
  <tr>
    <td>{{DATE}}</td>
    <!-- full state name does not display but is searchable -->
    <td>{{STATE}} <span style="display:none;">{{STATENAME}}</td>
    <td>{{CITY}}</td>
    <td>{{TIME}} at<br/>{{LOCATION}}</td>
    <td><a href="{{LINK}}" targt="_blank">See event details</a></td>
  </tr>
</script>

<script id="row_count_template" type="text/template">
  <div id="div-row-count">{{ count }} Total Events</div>
  <div id="div-filter-count"></div>
</script>

<script id="update_date_template" type="text/template">
  <div>List last updated on {{ date }}</div>
</script>

<!-- move to external -->
<script type="text/javascript">
/*
* Searches the visible table for any matching letters.
* People can search against the full state name because
* full state name is in the table but not visible.
*
* modified from https://codepen.io/chriscoyier/pen/tIuBL
*/

(function(document) {
	'use strict';
	var LightTableFilter = (function(Arr) {
		var _input;
    var _reset;

		function _onInputEvent(e) {
			_input = e.target;
			var tables = document.getElementsByClassName(_input.getAttribute('data-table'));
			Arr.forEach.call(tables, function(table) {
				Arr.forEach.call(table.tBodies, function(tbody) {
					Arr.forEach.call(tbody.rows, _filter);
				});
			});
      // Based on field value --
      // show/hide reset btn + reset matches div
      if($('#table-input').val().length !=0){
        $('#table-reset').show();
      }
      else
      {
        $('#table-reset').hide();
        $("#div-filter-count").html("");
      }
		}

    function _onResetEvent(e) {
			_reset = e.target;
			var tables = document.getElementsByClassName(_reset.getAttribute('data-table'));
			Arr.forEach.call(tables, function(table) {
				Arr.forEach.call(table.tBodies, function(tbody) {
					Arr.forEach.call(tbody.rows, _filterReset);
				});
			});
      // Show placeholder txt + hide reset btn + reset matches div
      $("#table-input").val("");
      $('#table-reset').hide();
      $("#div-filter-count").html("");
		}

		function _filter(row) {
			var text = row.textContent.toLowerCase(), val = _input.value.toLowerCase();
			row.style.display = text.indexOf(val) === -1 ? 'none' : 'table-row';
      // Count visible rows + update matches div
      var filterCount = $('#events-table >tbody >tr:visible').length;
      if (filterCount == 1) {
        // make this an external function
        var wordEval = "Event";
      }
      else {
        wordEval = "Events";
      }
      $("#div-filter-count").html('Found ' + filterCount + ' matching ' + wordEval);
		}

		function _filterReset(row) {
      // Reset to placeholder txt + reset table to original
			var text_reset = row.textContent.toLowerCase(), val_reset = "";
			row.style.display = text_reset.indexOf(val_reset) === -1 ? 'none' : 'table-row';
		}

		return {
			init: function() {
				var inputs = document.getElementsByClassName('light-table-filter');
				var resets = document.getElementsByClassName('reset-table-filter');
				Arr.forEach.call(inputs, function(input) {
					input.oninput = _onInputEvent;

				});
				Arr.forEach.call(resets, function(reset) {
         reset.onclick  = _onResetEvent;
				});
			}
		};
	})(Array.prototype);

	document.addEventListener('readystatechange', function() {
		if (document.readyState === 'complete') {
			LightTableFilter.init();
		}
	});

})(document);

</script>


<!-- end /container -->
</div>

<!-- Other JS scripts -->
<script src="assets/js/application.js"></script>

</body>
</html>
